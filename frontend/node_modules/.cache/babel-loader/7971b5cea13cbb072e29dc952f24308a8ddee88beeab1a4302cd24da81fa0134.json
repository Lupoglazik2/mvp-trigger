{"ast":null,"code":"import _objectSpread from\"/Users/irina/mvp-trigger/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import ReactFlow,{addEdge,Background,Controls,MiniMap,useEdgesState,useNodesState,Handle,Position,ReactFlowProvider,useReactFlow}from'reactflow';import NodeInspector from'./components/NodeInspector';import SimulationModal from'./components/SimulationModal';import StatsTooltip from'./components/StatsTooltip';import{saveChain,loadChain,simulate}from'./api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const initialNodes=[{id:'event1',type:'event',position:{x:0,y:0},data:{label:'Контакт добавлен',eventType:'contact_added',listName:'Newsletter'}},{id:'action1',type:'action',position:{x:250,y:0},data:{label:'Ждем 1 день',actionType:'wait',delayValue:1,delayUnit:'days'}},{id:'cond1',type:'condition',position:{x:500,y:-100},data:{label:'Дата > 2025-08-20',conditionType:'date',operator:'>',value:'2025-08-20'}},{id:'action2',type:'action',position:{x:750,y:-150},data:{label:'Отправить письмо',actionType:'send_email',subject:'Здравствуйте!',body:'Добро пожаловать в нашу рассылку.'}},{id:'stop1',type:'action',position:{x:1000,y:-150},data:{label:'Стоп',actionType:'stop'}},{id:'stop2',type:'action',position:{x:750,y:0},data:{label:'Стоп',actionType:'stop'}}];const initialEdges=[{id:'e1-2',source:'event1',target:'action1'},{id:'e2-3',source:'action1',target:'cond1'},{id:'e3-4',source:'cond1',target:'action2',label:'yes',data:{path:'yes'}},{id:'e4-5',source:'action2',target:'stop1'},{id:'e3-6',source:'cond1',target:'stop2',label:'no',data:{path:'no'}}];function nodeStyleForType(nodeType){if(nodeType==='event')return{borderColor:'#0ea5e9',background:'#e0f2fe'};if(nodeType==='condition')return{borderColor:'#f59e0b',background:'#fff7ed'};return{borderColor:'#10b981',background:'#ecfdf5'};}function DefaultNode(_ref){let{data,nodeType}=_ref;let style=nodeStyleForType(nodeType);if(nodeType==='action'&&((data===null||data===void 0?void 0:data.actionType)==='stop'||((data===null||data===void 0?void 0:data.label)||'').toLowerCase()==='стоп')){style={borderColor:'#ef4444',background:'#fee2e2'};}return/*#__PURE__*/_jsxs(\"div\",{style:{padding:8,border:'1px solid '+style.borderColor,background:style.background,borderRadius:6,minWidth:140,textAlign:'center',fontSize:12},children:[/*#__PURE__*/_jsx(Handle,{type:\"target\",position:Position.Left}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:(data===null||data===void 0?void 0:data.label)||nodeType}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#666',marginTop:4},children:[nodeType==='event'&&((data===null||data===void 0?void 0:data.eventType)||''),nodeType==='action'&&((data===null||data===void 0?void 0:data.actionType)||''),nodeType==='condition'&&((data===null||data===void 0?void 0:data.conditionType)||'')]}),nodeType==='condition'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Handle,{type:\"source\",id:\"yes\",position:Position.Right,style:{top:'30%'}}),/*#__PURE__*/_jsx(Handle,{type:\"source\",id:\"no\",position:Position.Right,style:{top:'70%'}})]}):nodeType==='action'&&(data===null||data===void 0?void 0:data.actionType)==='stop'?null:/*#__PURE__*/_jsx(Handle,{type:\"source\",position:Position.Right})]});}export default function App(){const[nodes,setNodes,onNodesChange]=useNodesState(initialNodes);const[edges,setEdges,onEdgesChange]=useEdgesState(initialEdges);const[selected,setSelected]=useState(null);const[logs,setLogs]=useState([]);const[userMessages,setUserMessages]=useState([]);const[modalOpen,setModalOpen]=useState(false);const[now,setNow]=useState(()=>new Date().toISOString());const[contextInputs,setContextInputs]=useState({emailOpened:'',emailClicked:''});const[error,setError]=useState(null);const[simOpen,setSimOpen]=useState(false);const[isStatsMode,setIsStatsMode]=useState(false);const nodeTypes=useMemo(()=>({event:props=>/*#__PURE__*/_jsx(DefaultNode,_objectSpread(_objectSpread({},props),{},{nodeType:\"event\"})),action:props=>/*#__PURE__*/_jsx(DefaultNode,_objectSpread(_objectSpread({},props),{},{nodeType:\"action\"})),condition:props=>/*#__PURE__*/_jsx(DefaultNode,_objectSpread(_objectSpread({},props),{},{nodeType:\"condition\"}))}),[]);const emailOptions=useMemo(()=>{return nodes.filter(n=>{var _n$data;return n.type==='action'&&(n===null||n===void 0?void 0:(_n$data=n.data)===null||_n$data===void 0?void 0:_n$data.actionType)==='send_email';}).map(n=>{var _n$data2,_n$data3;return{id:n.id,name:(n===null||n===void 0?void 0:(_n$data2=n.data)===null||_n$data2===void 0?void 0:_n$data2.subject)||(n===null||n===void 0?void 0:(_n$data3=n.data)===null||_n$data3===void 0?void 0:_n$data3.label)||\"Email \".concat(n.id)};});},[nodes]);const downstreamEmailIds=useMemo(()=>{if(!selected)return new Set();const queue=[selected.id];const visited=new Set(queue);const result=new Set();while(queue.length){const curr=queue.shift();edges.filter(e=>e.source===curr).forEach(e=>{const t=e.target;if(!visited.has(t)){visited.add(t);queue.push(t);}});}nodes.forEach(n=>{var _n$data4;if(visited.has(n.id)&&n.id!==selected.id&&n.type==='action'&&(n===null||n===void 0?void 0:(_n$data4=n.data)===null||_n$data4===void 0?void 0:_n$data4.actionType)==='send_email'){result.add(n.id);}});return result;},[selected,edges,nodes]);const onConnect=useCallback(params=>{setEdges(eds=>{const sourceNode=nodes.find(n=>n.id===params.source);const newEdge=_objectSpread(_objectSpread({},params),{},{id:\"e-\".concat(Math.random().toString(36).slice(2,8))});if((sourceNode===null||sourceNode===void 0?void 0:sourceNode.type)==='condition'){const path=params.sourceHandle==='yes'?'yes':'no';newEdge.data=_objectSpread(_objectSpread({},newEdge.data||{}),{},{path});newEdge.label=path;}return addEdge(newEdge,eds);});},[setEdges,nodes]);const onNodeClick=useCallback((_e,node)=>{setSelected(node);},[]);const onNodeUpdate=updatedNode=>{setNodes(nds=>nds.map(n=>n.id===updatedNode.id?updatedNode:n));setSelected(updatedNode);};const onDragStart=(event,nodeType)=>{event.dataTransfer.setData('application/reactflow',nodeType);event.dataTransfer.effectAllowed='move';};const handleSave=async()=>{await saveChain({nodes,edges});alert('Saved');};const handleLoad=async()=>{const chain=await loadChain();if(chain){setNodes(chain.nodes);setEdges(chain.edges);setSelected(null);}else{alert('No saved chain found');}};const handleSimulate=async()=>{try{var _firstEvent$data,_firstEvent$data2,_result$context;console.log('Starting simulation with:',{nodes,edges,now,contextInputs});// Find the first event node to determine trigger type\nconst firstEvent=nodes.find(n=>n.type==='event');if(!firstEvent){alert('Нет событий в цепочке для симуляции');return;}const trigger={type:((_firstEvent$data=firstEvent.data)===null||_firstEvent$data===void 0?void 0:_firstEvent$data.eventType)||'contact_added',payload:{listName:((_firstEvent$data2=firstEvent.data)===null||_firstEvent$data2===void 0?void 0:_firstEvent$data2.listName)||'Newsletter',email:'user@example.com'}};console.log('Using trigger:',trigger);const result=await simulate({nodes,edges},trigger,_objectSpread({now},contextInputs));console.log('Simulation result:',result);console.log('userMessages from result:',result.userMessages);console.log('logs from result:',result.logs);setLogs(result.logs||[]);setUserMessages(result.userMessages||[]);console.log('userMessages state after set:',result.userMessages||[]);if((_result$context=result.context)!==null&&_result$context!==void 0&&_result$context.now)setNow(result.context.now);setModalOpen(true);}catch(error){console.error('Simulation error:',error);alert(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0441\\u0438\\u043C\\u0443\\u043B\\u044F\\u0446\\u0438\\u0438: \".concat(error.message));}};useEffect(()=>{// Ensure a clean selection if node removed\nif(selected&&!nodes.find(n=>n.id===selected.id)){setSelected(null);}},[nodes,selected]);if(error){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20,color:'red'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432 \\u043F\\u0440\\u0438\\u043B\\u043E\\u0436\\u0435\\u043D\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),children:\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"})]});}try{return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',height:'100vh',width:'100vw'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ui-panel\",style:{width:280},children:[/*#__PURE__*/_jsx(\"div\",{className:\"ui-panel-header\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"ui-title\",children:\"\\u041A\\u043E\\u043D\\u0441\\u0442\\u0440\\u0443\\u043A\\u0442\\u043E\\u0440 \\u0446\\u0435\\u043F\\u043E\\u0447\\u0435\\u043A \\u043F\\u0438\\u0441\\u0435\\u043C\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ui-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ui-field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"ui-label\",children:\"\\u0420\\u0435\\u0436\\u0438\\u043C \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ui-row\",style:{gap:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"ui-button \".concat(!isStatsMode?'ui-button-primary':'ui-button-outline'),onClick:()=>setIsStatsMode(false),style:{flex:1},children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ui-button \".concat(isStatsMode?'ui-button-primary':'ui-button-outline'),onClick:()=>setIsStatsMode(true),style:{flex:1},children:\"\\u0421\\u0442\\u0430\\u0442\\u0438\\u0441\\u0442\\u0438\\u043A\\u0430\"})]})]})}),!isStatsMode?/*#__PURE__*/_jsxs(\"div\",{className:\"ui-section\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:8,marginBottom:12},children:[/*#__PURE__*/_jsx(\"button\",{className:\"ui-button ui-button-outline--event\",draggable:true,onDragStart:e=>onDragStart(e,'event'),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043E\\u0431\\u044B\\u0442\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ui-button ui-button-outline--action\",draggable:true,onDragStart:e=>onDragStart(e,'action'),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ui-button ui-button-outline--condition\",draggable:true,onDragStart:e=>onDragStart(e,'condition'),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0443\\u0441\\u043B\\u043E\\u0432\\u0438\\u0435\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ui-row\",style:{marginBottom:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"ui-button\",onClick:handleSave,children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ui-button\",onClick:handleLoad,children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ui-field\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"ui-accordion\",onClick:()=>setSimOpen(v=>!v),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041A\\u043E\\u043D\\u0442\\u0435\\u043A\\u0441\\u0442 \\u0441\\u0438\\u043C\\u0443\\u043B\\u044F\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ui-badge\",children:\"\\u043B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u043E\"}),/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:'auto'},children:simOpen?'▲':'▼'})]})}),simOpen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ui-field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"ui-label\",children:\"\\u0422\\u0435\\u043A\\u0443\\u0449\\u0435\\u0435 \\u0432\\u0440\\u0435\\u043C\\u044F (ISO)\"}),/*#__PURE__*/_jsx(\"input\",{className:\"ui-input\",value:now,onChange:e=>setNow(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ui-field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"ui-label\",children:\"\\u041E\\u0442\\u043A\\u0440\\u044B\\u0442\\u0438\\u0435 \\u043F\\u0438\\u0441\\u0435\\u043C\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"ui-select\",value:contextInputs.emailOpened||'',onChange:e=>setContextInputs(c=>_objectSpread(_objectSpread({},c),{},{emailOpened:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u041D\\u0435 \\u043E\\u0442\\u043A\\u0440\\u044B\\u0442\\u043E\"}),emailOptions.map(email=>/*#__PURE__*/_jsx(\"option\",{value:email.id,children:email.name},email.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ui-field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"ui-label\",children:\"\\u041A\\u043B\\u0438\\u043A \\u043F\\u043E \\u043F\\u0438\\u0441\\u044C\\u043C\\u0430\\u043C\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"ui-select\",value:contextInputs.emailClicked||'',onChange:e=>setContextInputs(c=>_objectSpread(_objectSpread({},c),{},{emailClicked:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u041D\\u0435 \\u043A\\u043B\\u0438\\u043A\\u043D\\u0443\\u0442\\u043E\"}),emailOptions.map(email=>/*#__PURE__*/_jsx(\"option\",{value:email.id,children:email.name},email.id))]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"ui-button ui-button-primary\",onClick:handleSimulate,style:{width:'100%',marginBottom:12},children:\"\\u0417\\u0430\\u043F\\u0443\\u0441\\u0442\\u0438\\u0442\\u044C \\u0441\\u0438\\u043C\\u0443\\u043B\\u044F\\u0446\\u0438\\u044E\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ui-field\",children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,marginBottom:4},children:\"\\u041B\\u043E\\u0433\\u0438\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ui-logs\",children:(logs||[]).map((l,i)=>/*#__PURE__*/_jsx(\"div\",{style:{fontFamily:'ui-monospace, SFMono-Regular, Menlo, monospace',fontSize:12,marginBottom:4},children:l},i))})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"ui-section\",children:/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'20px 0'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'18px',fontWeight:'600',marginBottom:'8px',color:'#6366f1'},children:\"\\uD83D\\uDCCA \\u0420\\u0435\\u0436\\u0438\\u043C \\u0441\\u0442\\u0430\\u0442\\u0438\\u0441\\u0442\\u0438\\u043A\\u0438\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#64748b',lineHeight:'1.5'},children:\"\\u041D\\u0430\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043A\\u0443\\u0440\\u0441\\u043E\\u0440 \\u043D\\u0430 \\u043B\\u044E\\u0431\\u043E\\u0439 \\u0443\\u0437\\u0435\\u043B \\u0446\\u0435\\u043F\\u043E\\u0447\\u043A\\u0438 \\u0434\\u043B\\u044F \\u043F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440\\u0430 \\u0441\\u0442\\u0430\\u0442\\u0438\\u0441\\u0442\\u0438\\u043A\\u0438\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex'},children:/*#__PURE__*/_jsxs(ReactFlowProvider,{children:[/*#__PURE__*/_jsx(FlowCanvas,{nodes:nodes,edges:edges,onNodesChange:onNodesChange,onEdgesChange:onEdgesChange,onConnect:onConnect,onNodeClick:onNodeClick,nodeTypes:nodeTypes,setNodes:setNodes,setSelected:setSelected,isStatsMode:isStatsMode}),!isStatsMode&&/*#__PURE__*/_jsx(\"div\",{className:\"ui-panel ui-panel-right\",style:{width:360},children:/*#__PURE__*/_jsx(NodeInspector,{node:selected,onChange:onNodeUpdate,emailOptions:emailOptions.map(opt=>_objectSpread(_objectSpread({},opt),{},{isFuture:downstreamEmailIds.has(opt.id)}))})})]})}),/*#__PURE__*/_jsx(SimulationModal,{open:modalOpen,steps:logs,userMessages:userMessages,onClose:()=>setModalOpen(false)})]})});}catch(err){console.error('Render error:',err);setError(err.message||'Неизвестная ошибка рендера');return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20,color:'red'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432 \\u043F\\u0440\\u0438\\u043B\\u043E\\u0436\\u0435\\u043D\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"p\",{children:err.message||'Неизвестная ошибка'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),children:\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"})]});}}function FlowCanvas(_ref2){let{nodes,edges,onNodesChange,onEdgesChange,onConnect,onNodeClick,nodeTypes,setNodes,setSelected,isStatsMode}=_ref2;try{const{project}=useReactFlow();const wrapperRef=useRef(null);const[tooltipState,setTooltipState]=useState({isVisible:false,node:null,position:{x:0,y:0}});const onDragOver=useCallback(event=>{event.preventDefault();event.dataTransfer.dropEffect='move';},[]);const onDrop=useCallback(event=>{if(isStatsMode)return;// Отключаем в режиме статистики\nevent.preventDefault();const type=event.dataTransfer.getData('application/reactflow');if(!type)return;const bounds=wrapperRef.current.getBoundingClientRect();const position=project({x:event.clientX-bounds.left,y:event.clientY-bounds.top});const id=\"\".concat(type,\"-\").concat(Math.random().toString(36).slice(2,7));const base={id,type,position,data:{label:type}};if(type==='event')base.data=_objectSpread(_objectSpread({},base.data),{},{eventType:'contact_added'});if(type==='action')base.data=_objectSpread(_objectSpread({},base.data),{},{actionType:'wait',delayValue:1,delayUnit:'days'});if(type==='condition')base.data=_objectSpread(_objectSpread({},base.data),{},{conditionType:'date',operator:'>',value:''});setNodes(nds=>nds.concat(base));setSelected(base);},[project,setNodes,setSelected,isStatsMode]);const onNodeMouseEnter=useCallback((_e,node)=>{if(!isStatsMode)return;setTooltipState({isVisible:true,node,position:{x:_e.clientX+20,y:_e.clientY-20}});},[isStatsMode]);const onNodeMouseLeave=useCallback(()=>{if(!isStatsMode)return;setTooltipState(prev=>_objectSpread(_objectSpread({},prev),{},{isVisible:false}));},[isStatsMode]);return/*#__PURE__*/_jsxs(\"div\",{ref:wrapperRef,style:{flex:1},children:[/*#__PURE__*/_jsxs(ReactFlow,{nodes:nodes,edges:edges,onNodesChange:isStatsMode?undefined:onNodesChange,onEdgesChange:isStatsMode?undefined:onEdgesChange,onConnect:isStatsMode?undefined:onConnect,onNodeClick:onNodeClick,onNodeMouseEnter:onNodeMouseEnter,onNodeMouseLeave:onNodeMouseLeave,nodeTypes:nodeTypes,onDrop:onDrop,onDragOver:onDragOver,fitView:true,children:[/*#__PURE__*/_jsx(MiniMap,{}),/*#__PURE__*/_jsx(Controls,{}),/*#__PURE__*/_jsx(Background,{gap:12,size:1})]}),isStatsMode&&/*#__PURE__*/_jsx(StatsTooltip,{node:tooltipState.node,isVisible:tooltipState.isVisible,position:tooltipState.position})]});}catch(err){console.error('FlowCanvas error:',err);return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20,color:'red',flex:1},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432 \\u0445\\u043E\\u043B\\u0441\\u0442\\u0435\"}),/*#__PURE__*/_jsx(\"p\",{children:err.message||'Неизвестная ошибка'})]});}}","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","ReactFlow","addEdge","Background","Controls","MiniMap","useEdgesState","useNodesState","Handle","Position","ReactFlowProvider","useReactFlow","NodeInspector","SimulationModal","StatsTooltip","saveChain","loadChain","simulate","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","initialNodes","id","type","position","x","y","data","label","eventType","listName","actionType","delayValue","delayUnit","conditionType","operator","value","subject","body","initialEdges","source","target","path","nodeStyleForType","nodeType","borderColor","background","DefaultNode","_ref","style","toLowerCase","padding","border","borderRadius","minWidth","textAlign","fontSize","children","Left","fontWeight","color","marginTop","Right","top","App","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","selected","setSelected","logs","setLogs","userMessages","setUserMessages","modalOpen","setModalOpen","now","setNow","Date","toISOString","contextInputs","setContextInputs","emailOpened","emailClicked","error","setError","simOpen","setSimOpen","isStatsMode","setIsStatsMode","nodeTypes","event","props","_objectSpread","action","condition","emailOptions","filter","n","_n$data","map","_n$data2","_n$data3","name","concat","downstreamEmailIds","Set","queue","visited","result","length","curr","shift","e","forEach","t","has","add","push","_n$data4","onConnect","params","eds","sourceNode","find","newEdge","Math","random","toString","slice","sourceHandle","onNodeClick","_e","node","onNodeUpdate","updatedNode","nds","onDragStart","dataTransfer","setData","effectAllowed","handleSave","alert","handleLoad","chain","handleSimulate","_firstEvent$data","_firstEvent$data2","_result$context","console","log","firstEvent","trigger","payload","email","context","message","onClick","display","height","width","className","gap","flex","flexDirection","marginBottom","draggable","v","marginLeft","onChange","c","l","i","fontFamily","lineHeight","FlowCanvas","opt","isFuture","open","steps","onClose","err","_ref2","project","wrapperRef","tooltipState","setTooltipState","isVisible","onDragOver","preventDefault","dropEffect","onDrop","getData","bounds","current","getBoundingClientRect","clientX","left","clientY","base","onNodeMouseEnter","onNodeMouseLeave","prev","ref","undefined","fitView","size"],"sources":["/Users/irina/mvp-trigger/frontend/src/App.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, {\n  addEdge,\n  Background,\n  Controls,\n  MiniMap,\n  useEdgesState,\n  useNodesState,\n  Handle,\n  Position,\n  ReactFlowProvider,\n  useReactFlow,\n} from 'reactflow';\nimport NodeInspector from './components/NodeInspector';\nimport SimulationModal from './components/SimulationModal';\nimport StatsTooltip from './components/StatsTooltip';\nimport { saveChain, loadChain, simulate } from './api';\n\nconst initialNodes = [\n  {\n    id: 'event1',\n    type: 'event',\n    position: { x: 0, y: 0 },\n    data: { label: 'Контакт добавлен', eventType: 'contact_added', listName: 'Newsletter' },\n  },\n  {\n    id: 'action1',\n    type: 'action',\n    position: { x: 250, y: 0 },\n    data: { label: 'Ждем 1 день', actionType: 'wait', delayValue: 1, delayUnit: 'days' },\n  },\n  {\n    id: 'cond1',\n    type: 'condition',\n    position: { x: 500, y: -100 },\n    data: { label: 'Дата > 2025-08-20', conditionType: 'date', operator: '>', value: '2025-08-20' },\n  },\n  {\n    id: 'action2',\n    type: 'action',\n    position: { x: 750, y: -150 },\n    data: { label: 'Отправить письмо', actionType: 'send_email', subject: 'Здравствуйте!', body: 'Добро пожаловать в нашу рассылку.' },\n  },\n  {\n    id: 'stop1',\n    type: 'action',\n    position: { x: 1000, y: -150 },\n    data: { label: 'Стоп', actionType: 'stop' },\n  },\n  {\n    id: 'stop2',\n    type: 'action',\n    position: { x: 750, y: 0 },\n    data: { label: 'Стоп', actionType: 'stop' },\n  },\n];\n\nconst initialEdges = [\n  { id: 'e1-2', source: 'event1', target: 'action1' },\n  { id: 'e2-3', source: 'action1', target: 'cond1' },\n  { id: 'e3-4', source: 'cond1', target: 'action2', label: 'yes', data: { path: 'yes' } },\n  { id: 'e4-5', source: 'action2', target: 'stop1' },\n  { id: 'e3-6', source: 'cond1', target: 'stop2', label: 'no', data: { path: 'no' } },\n];\n\nfunction nodeStyleForType(nodeType) {\n  if (nodeType === 'event') return { borderColor: '#0ea5e9', background: '#e0f2fe' };\n  if (nodeType === 'condition') return { borderColor: '#f59e0b', background: '#fff7ed' };\n  return { borderColor: '#10b981', background: '#ecfdf5' };\n}\n\nfunction DefaultNode({ data, nodeType }) {\n  let style = nodeStyleForType(nodeType);\n  if (nodeType === 'action' && (data?.actionType === 'stop' || (data?.label || '').toLowerCase() === 'стоп')) {\n    style = { borderColor: '#ef4444', background: '#fee2e2' };\n  }\n  return (\n    <div style={{\n      padding: 8,\n      border: '1px solid ' + style.borderColor,\n      background: style.background,\n      borderRadius: 6,\n      minWidth: 140,\n      textAlign: 'center',\n      fontSize: 12,\n    }}>\n      <Handle type=\"target\" position={Position.Left} />\n      <div style={{ fontWeight: 600 }}>{data?.label || nodeType}</div>\n      <div style={{ color: '#666', marginTop: 4 }}>\n        {nodeType === 'event' && (data?.eventType || '')}\n        {nodeType === 'action' && (data?.actionType || '')}\n        {nodeType === 'condition' && (data?.conditionType || '')}\n      </div>\n      {nodeType === 'condition' ? (\n        <>\n          <Handle type=\"source\" id=\"yes\" position={Position.Right} style={{ top: '30%' }} />\n          <Handle type=\"source\" id=\"no\" position={Position.Right} style={{ top: '70%' }} />\n        </>\n      ) : nodeType === 'action' && data?.actionType === 'stop' ? null : (\n        <Handle type=\"source\" position={Position.Right} />\n      )}\n    </div>\n  );\n}\n\nexport default function App() {\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\n  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\n  const [selected, setSelected] = useState(null);\n  const [logs, setLogs] = useState([]);\n  const [userMessages, setUserMessages] = useState([]);\n  const [modalOpen, setModalOpen] = useState(false);\n  const [now, setNow] = useState(() => new Date().toISOString());\n  const [contextInputs, setContextInputs] = useState({ emailOpened: '', emailClicked: '' });\n  const [error, setError] = useState(null);\n  const [simOpen, setSimOpen] = useState(false);\n  const [isStatsMode, setIsStatsMode] = useState(false);\n\n  const nodeTypes = useMemo(() => ({\n    event: (props) => <DefaultNode {...props} nodeType=\"event\" />,\n    action: (props) => <DefaultNode {...props} nodeType=\"action\" />,\n    condition: (props) => <DefaultNode {...props} nodeType=\"condition\" />,\n  }), []);\n\n  const emailOptions = useMemo(() => {\n    return nodes\n      .filter((n) => n.type === 'action' && n?.data?.actionType === 'send_email')\n      .map((n) => ({ id: n.id, name: n?.data?.subject || n?.data?.label || `Email ${n.id}` }));\n  }, [nodes]);\n\n  const downstreamEmailIds = useMemo(() => {\n    if (!selected) return new Set();\n    const queue = [selected.id];\n    const visited = new Set(queue);\n    const result = new Set();\n    while (queue.length) {\n      const curr = queue.shift();\n      edges.filter((e) => e.source === curr).forEach((e) => {\n        const t = e.target;\n        if (!visited.has(t)) {\n          visited.add(t);\n          queue.push(t);\n        }\n      });\n    }\n    nodes.forEach((n) => {\n      if (visited.has(n.id) && n.id !== selected.id && n.type === 'action' && n?.data?.actionType === 'send_email') {\n        result.add(n.id);\n      }\n    });\n    return result;\n  }, [selected, edges, nodes]);\n\n  const onConnect = useCallback((params) => {\n    setEdges((eds) => {\n      const sourceNode = nodes.find((n) => n.id === params.source);\n      const newEdge = { ...params, id: `e-${Math.random().toString(36).slice(2, 8)}` };\n      if (sourceNode?.type === 'condition') {\n        const path = params.sourceHandle === 'yes' ? 'yes' : 'no';\n        newEdge.data = { ...(newEdge.data || {}), path };\n        newEdge.label = path;\n      }\n      return addEdge(newEdge, eds);\n    });\n  }, [setEdges, nodes]);\n\n  const onNodeClick = useCallback((_e, node) => {\n    setSelected(node);\n  }, []);\n\n\n\n  const onNodeUpdate = (updatedNode) => {\n    setNodes((nds) => nds.map((n) => (n.id === updatedNode.id ? updatedNode : n)));\n    setSelected(updatedNode);\n  };\n\n  const onDragStart = (event, nodeType) => {\n    event.dataTransfer.setData('application/reactflow', nodeType);\n    event.dataTransfer.effectAllowed = 'move';\n  };\n\n  const handleSave = async () => {\n    await saveChain({ nodes, edges });\n    alert('Saved');\n  };\n\n  const handleLoad = async () => {\n    const chain = await loadChain();\n    if (chain) {\n      setNodes(chain.nodes);\n      setEdges(chain.edges);\n      setSelected(null);\n    } else {\n      alert('No saved chain found');\n    }\n  };\n\n  const handleSimulate = async () => {\n    try {\n      console.log('Starting simulation with:', { nodes, edges, now, contextInputs });\n      \n      // Find the first event node to determine trigger type\n      const firstEvent = nodes.find(n => n.type === 'event');\n      if (!firstEvent) {\n        alert('Нет событий в цепочке для симуляции');\n        return;\n      }\n      \n      const trigger = { \n        type: firstEvent.data?.eventType || 'contact_added', \n        payload: { \n          listName: firstEvent.data?.listName || 'Newsletter', \n          email: 'user@example.com' \n        } \n      };\n      \n      console.log('Using trigger:', trigger);\n      \n      const result = await simulate({ nodes, edges }, trigger, { now, ...contextInputs });\n      console.log('Simulation result:', result);\n      console.log('userMessages from result:', result.userMessages);\n      console.log('logs from result:', result.logs);\n      \n      setLogs(result.logs || []);\n      setUserMessages(result.userMessages || []);\n      console.log('userMessages state after set:', result.userMessages || []);\n      if (result.context?.now) setNow(result.context.now);\n      setModalOpen(true);\n    } catch (error) {\n      console.error('Simulation error:', error);\n      alert(`Ошибка симуляции: ${error.message}`);\n    }\n  };\n\n  useEffect(() => {\n    // Ensure a clean selection if node removed\n    if (selected && !nodes.find((n) => n.id === selected.id)) {\n      setSelected(null);\n    }\n  }, [nodes, selected]);\n\n  if (error) {\n    return (\n      <div style={{ padding: 20, color: 'red' }}>\n        <h1>Ошибка в приложении</h1>\n        <p>{error}</p>\n        <button onClick={() => setError(null)}>Попробовать снова</button>\n      </div>\n    );\n  }\n\n  try {\n    return (\n      <>\n        <div style={{ display: 'flex', height: '100vh', width: '100vw' }}>\n          <div className=\"ui-panel\" style={{ width: 280 }}>\n            <div className=\"ui-panel-header\">\n              <h2 className=\"ui-title\">Конструктор цепочек писем</h2>\n            </div>\n            \n            <div className=\"ui-section\">\n              <div className=\"ui-field\">\n                <label className=\"ui-label\">Режим работы</label>\n                <div className=\"ui-row\" style={{ gap: 8 }}>\n                  <button \n                    className={`ui-button ${!isStatsMode ? 'ui-button-primary' : 'ui-button-outline'}`}\n                    onClick={() => setIsStatsMode(false)}\n                    style={{ flex: 1 }}\n                  >\n                    Редактирование\n                  </button>\n                  <button \n                    className={`ui-button ${isStatsMode ? 'ui-button-primary' : 'ui-button-outline'}`}\n                    onClick={() => setIsStatsMode(true)}\n                    style={{ flex: 1 }}\n                  >\n                    Статистика\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {!isStatsMode ? (\n              <div className=\"ui-section\">\n                <div style={{ display: 'flex', flexDirection: 'column', gap: 8, marginBottom: 12 }}>\n                  <button className=\"ui-button ui-button-outline--event\" draggable onDragStart={(e) => onDragStart(e, 'event')}>Добавить событие</button>\n                  <button className=\"ui-button ui-button-outline--action\" draggable onDragStart={(e) => onDragStart(e, 'action')}>Добавить действие</button>\n                  <button className=\"ui-button ui-button-outline--condition\" draggable onDragStart={(e) => onDragStart(e, 'condition')}>Добавить условие</button>\n                </div>\n\n                <div className=\"ui-row\" style={{ marginBottom: 8 }}>\n                  <button className=\"ui-button\" onClick={handleSave}>Сохранить</button>\n                  <button className=\"ui-button\" onClick={handleLoad}>Загрузить</button>\n                </div>\n\n                <div className=\"ui-field\">\n                  <button className=\"ui-accordion\" onClick={() => setSimOpen((v) => !v)}>\n                    <span>Контекст симуляции</span>\n                    <span className=\"ui-badge\">локально</span>\n                    <span style={{ marginLeft: 'auto' }}>{simOpen ? '▲' : '▼'}</span>\n                  </button>\n                </div>\n                {simOpen && (\n                  <>\n                    <div className=\"ui-field\">\n                      <label className=\"ui-label\">Текущее время (ISO)</label>\n                      <input className=\"ui-input\" value={now} onChange={(e) => setNow(e.target.value)} />\n                    </div>\n                    <div className=\"ui-field\">\n                      <label className=\"ui-label\">Открытие писем</label>\n                      <select \n                        className=\"ui-select\" \n                        value={contextInputs.emailOpened || ''} \n                        onChange={(e) => setContextInputs((c) => ({ ...c, emailOpened: e.target.value }))}\n                      >\n                        <option value=\"\">Не открыто</option>\n                        {emailOptions.map((email) => (\n                          <option key={email.id} value={email.id}>\n                            {email.name}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n                    \n                    <div className=\"ui-field\">\n                      <label className=\"ui-label\">Клик по письмам</label>\n                      <select \n                        className=\"ui-select\" \n                        value={contextInputs.emailClicked || ''} \n                        onChange={(e) => setContextInputs((c) => ({ ...c, emailClicked: e.target.value }))}\n                      >\n                        <option value=\"\">Не кликнуто</option>\n                        {emailOptions.map((email) => (\n                          <option key={email.id} value={email.id}>\n                            {email.name}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n\n                    <button className=\"ui-button ui-button-primary\" onClick={handleSimulate} style={{ width: '100%', marginBottom: 12 }}>Запустить симуляцию</button>\n                  </>\n                )}\n\n                <div className=\"ui-field\">\n                  <div style={{ fontWeight: 600, marginBottom: 4 }}>Логи</div>\n                  <div className=\"ui-logs\">\n                    {(logs || []).map((l, i) => (\n                      <div key={i} style={{ fontFamily: 'ui-monospace, SFMono-Regular, Menlo, monospace', fontSize: 12, marginBottom: 4 }}>\n                        {l}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"ui-section\">\n                <div style={{ textAlign: 'center', padding: '20px 0' }}>\n                  <div style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px', color: '#6366f1' }}>\n                    📊 Режим статистики\n                  </div>\n                  <div style={{ fontSize: '14px', color: '#64748b', lineHeight: '1.5' }}>\n                    Наведите курсор на любой узел цепочки для просмотра статистики\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div style={{ flex: 1, display: 'flex' }}>\n        <ReactFlowProvider>\n          <FlowCanvas\n            nodes={nodes}\n            edges={edges}\n            onNodesChange={onNodesChange}\n            onEdgesChange={onEdgesChange}\n            onConnect={onConnect}\n            onNodeClick={onNodeClick}\n            nodeTypes={nodeTypes}\n            setNodes={setNodes}\n            setSelected={setSelected}\n            isStatsMode={isStatsMode}\n          />\n          {!isStatsMode && (\n            <div className=\"ui-panel ui-panel-right\" style={{ width: 360 }}>\n              <NodeInspector\n                node={selected}\n                onChange={onNodeUpdate}\n                emailOptions={emailOptions.map((opt) => ({ ...opt, isFuture: downstreamEmailIds.has(opt.id) }))}\n              />\n            </div>\n          )}\n        </ReactFlowProvider>\n      </div>\n      <SimulationModal open={modalOpen} steps={logs} userMessages={userMessages} onClose={() => setModalOpen(false)} />\n        </div>\n      </>\n    );\n  } catch (err) {\n    console.error('Render error:', err);\n    setError(err.message || 'Неизвестная ошибка рендера');\n    return (\n      <div style={{ padding: 20, color: 'red' }}>\n        <h1>Ошибка в приложении</h1>\n        <p>{err.message || 'Неизвестная ошибка'}</p>\n        <button onClick={() => setError(null)}>Попробовать снова</button>\n      </div>\n    );\n  }\n}\n\nfunction FlowCanvas({ nodes, edges, onNodesChange, onEdgesChange, onConnect, onNodeClick, nodeTypes, setNodes, setSelected, isStatsMode }) {\n  try {\n    const { project } = useReactFlow();\n    const wrapperRef = useRef(null);\n    const [tooltipState, setTooltipState] = useState({ isVisible: false, node: null, position: { x: 0, y: 0 } });\n\n    const onDragOver = useCallback((event) => {\n      event.preventDefault();\n      event.dataTransfer.dropEffect = 'move';\n    }, []);\n\n    const onDrop = useCallback((event) => {\n      if (isStatsMode) return; // Отключаем в режиме статистики\n      event.preventDefault();\n      const type = event.dataTransfer.getData('application/reactflow');\n      if (!type) return;\n      const bounds = wrapperRef.current.getBoundingClientRect();\n      const position = project({ x: event.clientX - bounds.left, y: event.clientY - bounds.top });\n      const id = `${type}-${Math.random().toString(36).slice(2, 7)}`;\n      const base = { id, type, position, data: { label: type } };\n      if (type === 'event') base.data = { ...base.data, eventType: 'contact_added' };\n      if (type === 'action') base.data = { ...base.data, actionType: 'wait', delayValue: 1, delayUnit: 'days' };\n      if (type === 'condition') base.data = { ...base.data, conditionType: 'date', operator: '>', value: '' };\n      setNodes((nds) => nds.concat(base));\n      setSelected(base);\n    }, [project, setNodes, setSelected, isStatsMode]);\n\n    const onNodeMouseEnter = useCallback((_e, node) => {\n      if (!isStatsMode) return;\n      setTooltipState({\n        isVisible: true,\n        node,\n        position: { \n          x: _e.clientX + 20, \n          y: _e.clientY - 20\n        }\n      });\n    }, [isStatsMode]);\n\n    const onNodeMouseLeave = useCallback(() => {\n      if (!isStatsMode) return;\n      setTooltipState(prev => ({ ...prev, isVisible: false }));\n    }, [isStatsMode]);\n\n    return (\n      <div ref={wrapperRef} style={{ flex: 1 }}>\n        <ReactFlow\n          nodes={nodes}\n          edges={edges}\n          onNodesChange={isStatsMode ? undefined : onNodesChange}\n          onEdgesChange={isStatsMode ? undefined : onEdgesChange}\n          onConnect={isStatsMode ? undefined : onConnect}\n          onNodeClick={onNodeClick}\n          onNodeMouseEnter={onNodeMouseEnter}\n          onNodeMouseLeave={onNodeMouseLeave}\n          nodeTypes={nodeTypes}\n          onDrop={onDrop}\n          onDragOver={onDragOver}\n          fitView\n        >\n          <MiniMap />\n          <Controls />\n          <Background gap={12} size={1} />\n        </ReactFlow>\n        \n        {isStatsMode && (\n          <StatsTooltip\n            node={tooltipState.node}\n            isVisible={tooltipState.isVisible}\n            position={tooltipState.position}\n          />\n        )}\n      </div>\n    );\n  } catch (err) {\n    console.error('FlowCanvas error:', err);\n    return (\n      <div style={{ padding: 20, color: 'red', flex: 1 }}>\n        <h3>Ошибка в холсте</h3>\n        <p>{err.message || 'Неизвестная ошибка'}</p>\n      </div>\n    );\n  }\n}\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}